<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="public/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Page title -->
    <title>Menu - PurePlates</title>
    
    <!-- Link to external CSS stylesheet -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <div class="logo">PurePlates</div>
        <ul class="nav-menu">
          <li><a href="index.html">Home</a></li>
          <li><a href="menu.html" class="active">Menu</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="reservations.html">Reservations</a></li>
        </ul>
      </div>
    </nav>

    <section class="page-header">
      <h1>Our Menu</h1>
      <p>Fresh, healthy, and delicious dishes crafted with care</p>
    </section>

    <!-- Menu items loaded dynamically via API -->
    <section class="menu-section">
      <div class="container" id="menuContainer">
        <div style="text-align: center; padding: 40px;">
          <p style="color: #666; font-size: 1.1em;">Loading menu items...</p>
        </div>
      </div>
    </section>

    <!-- Shopping cart section -->
    <section class="cart-section">
      <div class="container">
        <h2>Your Shopping Cart</h2>
        <div id="cartItems" class="cart-items">
          <p>Your cart is empty. Start adding dishes!</p>
        </div>
        <div id="cartSummary" class="cart-summary" style="display: none;">
          <h3>Order Summary</h3>
          <p>Total: Rs. <span id="cartTotal">0.00</span></p>
          <button class="btn-primary" onclick="proceedToCheckout()">Proceed to Checkout</button>
          <button class="btn-secondary" onclick="clearCart()">Clear Cart</button>
        </div>
      </div>
    </section>

    <section class="cta-section">
      <div class="container">
        <h2>Ready to Dine With Us?</h2>
        <p>Book your table today and enjoy our fresh cuisine</p>
        <a href="reservations.html" class="btn-primary">Make Reservation</a>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>PurePlates</h4>
            <p>Fresh, healthy, delicious</p>
          </div>
          <div class="footer-section">
            <h4>Hours</h4>
            <p>Mon-Fri: 11am - 10pm</p>
            <p>Sat-Sun: 10am - 11pm</p>
          </div>
          <div class="footer-section">
            <h4>Contact</h4>
            <p>123 Health Street</p>
            <p>Phone: (555) 123-4567</p>
          </div>
        </div>
      </div>
    </footer>
    <script>
      let cart = [];
      let menuItems = [];

      // Load menu items from API
      function loadMenuItems() {
        console.log('üìã Loading menu items from API...');
        fetch('/pureplates/api.php/menu-items')
          .then(async response => {
            console.log('üìã Response status:', response.status);
            if (!response.ok) {
              let errorMsg = `HTTP ${response.status}`;
              // Read response as text first (can be parsed as JSON later if needed)
              const responseText = await response.text();
              try {
                // Try to parse as JSON
                const err = JSON.parse(responseText);
                errorMsg = err.error || errorMsg;
              } catch (e) {
                // If not JSON, use the text as error message
                errorMsg = responseText || errorMsg;
              }
              throw new Error(errorMsg);
            }
            return response.json();
          })
          .then(data => {
            console.log('üìã Menu items data:', data);
            let items = [];
            if (data.success && data.items) {
              items = data.items;
            } else if (Array.isArray(data)) {
              items = data;
            } else {
              throw new Error('Unexpected data format');
            }
            
            menuItems = items;
            displayMenuItems(items);
            console.log(`‚úÖ Loaded ${items.length} menu items`);
          })
          .catch(error => {
            console.error('‚ùå Error loading menu items:', error);
            const container = document.getElementById('menuContainer');
            container.innerHTML = `
              <div style="text-align: center; padding: 40px;">
                <p style="color: #f44336; font-size: 1.1em;">‚ö†Ô∏è Error loading menu items: ${error.message}</p>
                <button onclick="loadMenuItems()" style="margin-top: 20px; padding: 12px 24px; background-color: #2d5016; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                  Retry
                </button>
              </div>
            `;
          });
      }

      // Display menu items grouped by category
      function displayMenuItems(items) {
        const container = document.getElementById('menuContainer');
        
        if (!items || items.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px;">
              <p style="color: #666; font-size: 1.1em;">No menu items available at the moment.</p>
            </div>
          `;
          return;
        }

        // Group items by category
        const itemsByCategory = {};
        items.forEach(item => {
          const category = item.category || 'Other';
          if (!itemsByCategory[category]) {
            itemsByCategory[category] = [];
          }
          itemsByCategory[category].push(item);
        });

        // Generate HTML for each category
        let html = '';
        const categoryOrder = ['Appetizers', 'Main Courses', 'Desserts', 'Beverages'];
        
        // First, render categories in the specified order
        categoryOrder.forEach(category => {
          if (itemsByCategory[category] && itemsByCategory[category].length > 0) {
            html += generateCategoryHTML(category, itemsByCategory[category]);
            delete itemsByCategory[category];
          }
        });

        // Then render any remaining categories
        Object.keys(itemsByCategory).forEach(category => {
          html += generateCategoryHTML(category, itemsByCategory[category]);
        });

        container.innerHTML = html;
      }

      // Escape HTML to prevent XSS
      function escapeHtml(text) {
        if (!text) return '';
        const map = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        };
        return String(text).replace(/[&<>"']/g, m => map[m]);
      }

      // Generate HTML for a category
      function generateCategoryHTML(category, items) {
        let itemsHTML = '';
        items.forEach(item => {
          const price = parseFloat(item.price).toLocaleString('en-IN');
          const escapedName = escapeHtml(item.name);
          const escapedDesc = escapeHtml(item.description);
          // Use data attributes to avoid issues with quotes in item names
          itemsHTML += `
            <div class="menu-item">
              <div class="menu-item-header">
                <h3>${escapedName}</h3>
                <span class="price">Rs. ${price}</span>
              </div>
              <p>${escapedDesc}</p>
              <button class="btn-secondary" data-item-name="${escapedName}" data-item-price="${item.price}" onclick="addToCartFromButton(this)">Add to Cart</button>
            </div>
          `;
        });

        return `
          <div class="menu-category">
            <h2>${escapeHtml(category)}</h2>
            <div class="menu-grid">
              ${itemsHTML}
            </div>
          </div>
        `;
      }

      // Helper function to add to cart from button (avoids quote escaping issues)
      function addToCartFromButton(button) {
        const itemName = button.getAttribute('data-item-name');
        const itemPrice = parseFloat(button.getAttribute('data-item-price'));
        addToCart(itemName, itemPrice);
      }

      // Load menu items when page loads
      document.addEventListener('DOMContentLoaded', () => {
        loadMenuItems();
      });

      function addToCart(itemName, itemPrice) {
        const existingItem = cart.find(item => item.name === itemName);
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ name: itemName, price: itemPrice, quantity: 1 });
        }
        updateCart();
        showAddToCartPopup(itemName);
      }

      function updateCart() {
        const cartItemsContainer = document.getElementById('cartItems');
        const cartSummary = document.getElementById('cartSummary');
        const cartTotal = document.getElementById('cartTotal');

        if (cart.length === 0) {
          cartItemsContainer.innerHTML = '<p>Your cart is empty. Start adding dishes!</p>';
          cartSummary.style.display = 'none';
          return;
        }

        cartItemsContainer.innerHTML = '';
        let total = 0;

        cart.forEach((item, index) => {
          total += item.price * item.quantity;
          const cartItem = document.createElement('div');
          cartItem.classList.add('cart-item');
          const itemTotal = (item.price * item.quantity).toFixed(2);
          const formattedPrice = item.price.toLocaleString('en-IN');
          const formattedTotal = parseFloat(itemTotal).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
          cartItem.innerHTML = `
            <p><strong>${item.name}</strong> <br/> Rs. ${formattedPrice} √ó ${item.quantity} = <strong>Rs. ${formattedTotal}</strong></p>
            <button class="btn-small" onclick="removeFromCart(${index})">Remove</button>
          `;
          cartItemsContainer.appendChild(cartItem);
        });

        cartTotal.textContent = total.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        cartSummary.style.display = 'block';
      }

      function removeFromCart(index) {
        cart.splice(index, 1);
        updateCart();
      }

      function clearCart() {
        cart = [];
        updateCart();
      }

      function proceedToCheckout() {
        if (cart.length === 0) {
          showEmptyCartPopup();
          return;
        }

        showDeliveryDetailsForm();
      }

      function showDeliveryDetailsForm() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const formattedTotal = total.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});

        const deliveryHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 9999; overflow-y: auto; padding: 20px 0;" id="deliveryOverlay">
            <div style="background: white; padding: 40px; border-radius: 12px; max-width: 450px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); margin: auto;">
              <h2 style="color: #2d5016; margin-bottom: 25px; text-align: center; font-size: 1.6em;">Delivery Details</h2>
              
              <form id="deliveryForm" style="display: flex; flex-direction: column; gap: 15px;">
                <div>
                  <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Full Name *</label>
                  <input type="text" id="deliveryName" required placeholder="John Doe" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box; transition: border-color 0.3s;">
                </div>

                <div>
                  <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Phone Number *</label>
                  <input type="tel" id="deliveryPhone" required placeholder="9876543210" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box;">
                </div>

                <div>
                  <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Email Address *</label>
                  <input type="email" id="deliveryEmail" required placeholder="john@example.com" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box;">
                </div>

                <div>
                  <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Street Address *</label>
                  <input type="text" id="deliveryAddress" required placeholder="123 Main Street" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">City *</label>
                    <input type="text" id="deliveryCity" required placeholder="Colombo" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">ZIP Code *</label>
                    <input type="text" id="deliveryZip" required placeholder="12345" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box;">
                  </div>
                </div>

                <div>
                  <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Special Instructions (Optional)</label>
                  <textarea id="deliveryInstructions" placeholder="Leave at gate, ring doorbell twice, etc." rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; box-sizing: border-box; resize: none; font-family: inherit;"></textarea>
                </div>

                <div style="background: #f0f8ff; padding: 12px; border-radius: 6px; border-left: 4px solid #6b8e23; margin: 10px 0;">
                  <p style="margin: 0; color: #333; font-size: 0.95em;">
                    <strong>Total: Rs. ${formattedTotal}</strong>
                  </p>
                </div>

                <button type="button" onclick="submitDeliveryDetails()" style="width: 100%; padding: 14px; background-color: #2d5016; color: white; border: none; border-radius: 8px; font-size: 1.05em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                  Continue to Payment
                </button>

                <button type="button" onclick="closeDeliveryForm()" style="width: 100%; padding: 12px; background-color: #ccc; color: #333; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer;">
                  Cancel
                </button>
              </form>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', deliveryHTML);
      }

      function submitDeliveryDetails() {
        const name = document.getElementById('deliveryName').value;
        const phone = document.getElementById('deliveryPhone').value;
        const email = document.getElementById('deliveryEmail').value;
        const address = document.getElementById('deliveryAddress').value;
        const city = document.getElementById('deliveryCity').value;
        const zip = document.getElementById('deliveryZip').value;
        const instructions = document.getElementById('deliveryInstructions').value;

        // Validate all required fields
        if (!name || !phone || !email || !address || !city || !zip) {
          showErrorPopup('Please fill in all required fields');
          return;
        }

        // Store delivery details
        const deliveryDetails = { name, phone, email, address, city, zip, instructions };
        localStorage.setItem('delivery_details', JSON.stringify(deliveryDetails));

        // Close delivery form and show payment options
        closeDeliveryForm();
        showPaymentOptionsPopup();
      }

      function closeDeliveryForm() {
        const overlay = document.getElementById('deliveryOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      function showPaymentOptionsPopup() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const formattedTotal = total.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});

        const paymentHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 9999;" id="paymentOverlay">
            <div style="background: white; padding: 40px; border-radius: 12px; max-width: 400px; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
              <h2 style="color: #2d5016; margin-bottom: 20px; text-align: center;">Payment Options</h2>
              <p style="font-size: 1.1em; text-align: center; margin-bottom: 30px; color: #555;">
                <strong>Total Amount: Rs. ${formattedTotal}</strong>
              </p>
              
              <button onclick="selectPayment('credit_card')" style="width: 100%; padding: 15px; margin-bottom: 12px; background-color: #6b8e23; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                üí≥ Credit/Debit Card
              </button>
              
              <button onclick="selectPayment('cod')" style="width: 100%; padding: 15px; margin-bottom: 20px; background-color: #6b8e23; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                üíµ Cash on Delivery
              </button>
              
              <button onclick="closePaymentPopup()" style="width: 100%; padding: 12px; background-color: #ccc; color: #333; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer;">
                Cancel
              </button>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', paymentHTML);
      }

      function selectPayment(method) {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const formattedTotal = total.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        const paymentMethods = {
          'credit_card': 'Credit/Debit Card',
          'cod': 'Cash on Delivery',
          'wallet': 'Digital Wallet'
        };

        showPaymentProcessingPopup(formattedTotal, paymentMethods[method]);

        // Get delivery details from localStorage
        const deliveryDetails = JSON.parse(localStorage.getItem('delivery_details'));
        
        // Prepare order data
        const orderData = {
          customer_name: deliveryDetails.name,
          customer_email: deliveryDetails.email,
          customer_phone: deliveryDetails.phone,
          street_address: deliveryDetails.address,
          city: deliveryDetails.city,
          zip_code: deliveryDetails.zip,
          special_instructions: deliveryDetails.instructions,
          items: cart,
          total_price: total,
          payment_method: method
        };

        // Send order to backend
        fetch('/api/orders', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(orderData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('HTTP Error: ' + response.status);
          }
          return response.json();
        })
        .then(data => {
          // Close payment processing popup
          closePaymentProcessingPopup();
          
          if (data.success) {
            // Clear the cart and localStorage
            cart = [];
            updateCart();
            localStorage.removeItem('delivery_details');
            localStorage.removeItem('cart');
            
            // Close the payment popup
            closePaymentPopup();
            
            // Show success popup window
            showSuccessPopup(formattedTotal, paymentMethods[method], data.order_id);
          } else {
            showErrorPopup('Failed to place order: ' + (data.error || 'Unknown error'));
          }
        })
        .catch(error => {
          // Close payment processing popup
          closePaymentProcessingPopup();
          console.error('Error:', error);
          showErrorPopup('Error placing order: ' + error.message);
        });
      }

      function showSuccessPopup(total, paymentMethod, orderId) {
        const successHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 9999;" id="successOverlay">
            <div style="background: white; padding: 50px 40px; border-radius: 16px; max-width: 450px; box-shadow: 0 12px 48px rgba(0,0,0,0.25); text-align: center;">
              <div style="font-size: 4em; margin-bottom: 20px;">‚úÖ</div>
              <h2 style="color: #2d5016; margin-bottom: 15px; font-size: 1.8em;">Order Placed Successfully!</h2>
              <p style="font-size: 1.1em; color: #555; margin-bottom: 15px; line-height: 1.6;">
                Thank you for your purchase.
              </p>
              <div style="background: #f0f8ff; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #6b8e23;">
                <p style="margin: 8px 0; color: #333; font-size: 1em;">
                  <strong>Order ID:</strong> #${orderId}
                </p>
                <p style="margin: 8px 0; color: #333; font-size: 1em;">
                  <strong>Total Amount:</strong> Rs. ${total}
                </p>
                <p style="margin: 8px 0; color: #333; font-size: 1em;">
                  <strong>Payment Method:</strong> ${paymentMethod}
                </p>
              </div>
              <p style="font-size: 0.95em; color: #777; margin-bottom: 25px;">
                Your order has been confirmed. A confirmation email will be sent shortly.
              </p>
              <button onclick="closeSuccessPopup()" style="width: 100%; padding: 16px; background-color: #2d5016; color: white; border: none; border-radius: 8px; font-size: 1.05em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                Close
              </button>
            </div>
          </div>
        `;

        // Add success popup to page
        document.body.insertAdjacentHTML('beforeend', successHTML);
      }

      function closeSuccessPopup() {
        const overlay = document.getElementById('successOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      function closePaymentPopup() {
        const overlay = document.getElementById('paymentOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      function showErrorPopup(message) {
        const errorHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 9999;" id="errorOverlay" onclick="closeErrorPopup()">
            <div style="background: white; padding: 40px; border-radius: 12px; max-width: 350px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); text-align: center;" onclick="event.stopPropagation();">
              <div style="font-size: 3em; margin-bottom: 15px;">‚ö†Ô∏è</div>
              <h3 style="color: #ff6b35; margin-bottom: 10px; font-size: 1.3em;">Error</h3>
              <p style="color: #555; margin-bottom: 20px; font-size: 1.05em;">
                ${message}
              </p>
              <button onclick="closeErrorPopup()" style="width: 100%; padding: 12px; background-color: #ff6b35; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer;">
                OK
              </button>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', errorHTML);
      }

      function closeErrorPopup() {
        const overlay = document.getElementById('errorOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      function showAddToCartPopup(itemName) {
        const popupHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 8999;" id="addToCartOverlay" onclick="closeAddToCartPopup()">
            <div style="background: white; padding: 30px 40px; border-radius: 12px; max-width: 350px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); text-align: center; animation: slideIn 0.3s ease;" onclick="event.stopPropagation();">
              <div style="font-size: 3em; margin-bottom: 15px;">üõí</div>
              <h3 style="color: #2d5016; margin-bottom: 10px; font-size: 1.3em;">Added to Cart!</h3>
              <p style="color: #555; margin-bottom: 20px; font-size: 1.05em;">
                <strong>${itemName}</strong> has been added to your cart.
              </p>
              <button onclick="closeAddToCartPopup()" style="width: 100%; padding: 12px; background-color: #6b8e23; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                Continue Shopping
              </button>
            </div>
          </div>
          <style>
            @keyframes slideIn {
              from { transform: translateY(-20px); opacity: 0; }
              to { transform: translateY(0); opacity: 1; }
            }
          </style>
        `;
        document.body.insertAdjacentHTML('beforeend', popupHTML);
        setTimeout(closeAddToCartPopup, 2000);
      }

      function closeAddToCartPopup() {
        const overlay = document.getElementById('addToCartOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      function showEmptyCartPopup() {
        const popupHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 8999;" id="emptyCartOverlay">
            <div style="background: white; padding: 40px; border-radius: 12px; max-width: 350px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); text-align: center;">
              <div style="font-size: 3em; margin-bottom: 15px;">üõí</div>
              <h3 style="color: #ff6b35; margin-bottom: 10px; font-size: 1.3em;">Cart is Empty</h3>
              <p style="color: #555; margin-bottom: 20px; font-size: 1.05em;">
                Please add items to your cart before proceeding to checkout.
              </p>
              <button onclick="closeEmptyCartPopup()" style="width: 100%; padding: 12px; background-color: #2d5016; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                Close
              </button>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', popupHTML);
      }

      function closeEmptyCartPopup() {
        const overlay = document.getElementById('emptyCartOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      function showPaymentProcessingPopup(total, method) {
        const popupHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 8999;" id="paymentProcessingOverlay">
            <div style="background: white; padding: 40px; border-radius: 12px; max-width: 380px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); text-align: center;">
              <div style="font-size: 3em; margin-bottom: 15px; animation: spin 1s linear infinite;">üí≥</div>
              <h3 style="color: #2d5016; margin-bottom: 10px; font-size: 1.3em;">Processing Payment</h3>
              <p style="color: #555; margin-bottom: 10px; font-size: 1.05em;">
                <strong>Amount: Rs. ${total}</strong>
              </p>
              <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">
                Method: ${method}
              </p>
              <div style="width: 100%; height: 4px; background: #ddd; border-radius: 2px; overflow: hidden; margin-bottom: 15px;">
                <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #6b8e23, #ffeb3b); animation: progress 2s ease-in-out infinite;"></div>
              </div>
              <p style="color: #888; font-size: 0.9em;">Please wait...</p>
            </div>
          </div>
          <style>
            @keyframes spin {
              from { transform: rotate(0deg); }
              to { transform: rotate(360deg); }
            }
            @keyframes progress {
              0%, 100% { transform: translateX(-100%); }
              50% { transform: translateX(100%); }
            }
          </style>
        `;
        document.body.insertAdjacentHTML('beforeend', popupHTML);
        setTimeout(closePaymentProcessingPopup, 2500);
      }

      function closePaymentProcessingPopup() {
        const overlay = document.getElementById('paymentProcessingOverlay');
        if (overlay) {
          overlay.remove();
        }
      }
    </script>
    <script src="/main.js"></script>
  </body>
</html>
